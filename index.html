<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>New Tab - Skiovox Helper</title>
<style>
  * { font-family: "Noto sans", sans-serif; box-sizing: border-box; }
  body { padding: 8px; background: #212121; color: #ffffff; }
  .top-left { position: fixed; top: 20px; left: 20px; }
  .name { font-size: 22px; }
  .version { font: bold 14px monospace; }
  .icon-corner { position: fixed; display: flex; gap: 15px; }
  .top-right { top: 20px; right: 20px; }
  .bottom-left { bottom: 20px; left: 20px; }
  .bottom-right { bottom: 20px; right: 20px; }
  .center { position: fixed; top: 50%; left: 50%; width: 500px; display: flex; flex-direction: column; gap: 20px; text-align: center; transform: translate(-50%, -50%); }
  .date { font: 22.5px monospace; line-height: 50%; }
  .time { font-size: 55px; }
  .battery { font-size: 15px; }
  svg { color: white; filter: brightness(0) invert(1); margin: 1px; width: 30px; height: 30px; cursor: pointer; transition: transform 250ms; }
  svg:hover { transform: scale(1.2); }
  body.black-text { color: black; }
  body.black-text svg { filter: brightness(0); }
</style>
</head>
<body>
<div class="top-left">
  <div class="name">Skiovox Helper</div> 
  <span class="version"></span>
</div>

<div class="icon-corner top-right">
  <!-- put all your top right SVGs here in order -->
  <svg id="help" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
  <svg id="webstore" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16"/></svg>
  <svg id="addaccount" viewBox="0 0 24 24"><polygon points="4,4 20,12 4,20"/></svg>
  <svg id="move" viewBox="0 0 24 24"><path d="M0,0 L24,24"/></svg>
  <svg id="fullscreen" viewBox="0 0 24 24"><path d="M0,0 L24,24"/></svg>
  <svg id="reset" viewBox="0 0 24 24"><path d="M12,0 L12,24"/></svg>
  <svg id="theme" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
  <svg id="colorchange" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16"/></svg>
  <svg id="wifi" viewBox="0 0 24 24"><path d="M12 3 C6 9 6 15 12 21"/></svg>
  <svg id="bluetooth" viewBox="0 0 24 24"><path d="M12 3 L12 21"/></svg>
  <svg id="files" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16"/></svg>
  <svg id="settings" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
</div>

<div class="center">
  <div class="date"></div>
  <div class="time"></div>
  <div class="battery"></div>
</div>

<script>
/* ================= DragController ================= */
class Coords {
  constructor(x,y){this.x=x;this.y=y}
  static fromEvent(e){return new Coords(e.clientX,e.clientY)}
  static fromElement(el){let r=el.getBoundingClientRect(); return new Coords(r.left,r.top)}
  static fromDifference(c1,c2){return new Coords(c1.x-c2.x,c1.y-c2.y)}
}
class DragController {
  isMouseDown=false; clickOffset=null;
  constructor(el){
    el.style.position="absolute";
    el.addEventListener("mousedown",this.onMouseDown.bind(this));
    window.addEventListener("mousemove",this.onMouseMove.bind(this));
    window.addEventListener("mouseup",()=>this.isMouseDown=false);
    window.addEventListener("blur",()=>this.isMouseDown=false);
    this.el=el;
  }
  onMouseDown(e){
    this.isMouseDown=true;
    this.clickOffset=Coords.fromDifference(Coords.fromEvent(e),Coords.fromElement(this.el));
    e.preventDefault();
  }
  onMouseMove(e){
    if(!this.isMouseDown||!this.clickOffset)return;
    const delta=Coords.fromDifference(Coords.fromEvent(e),this.clickOffset);
    this.el.style.left=delta.x+"px";
    this.el.style.top=delta.y+"px";
  }
}

/* ================= BackgroundController ================= */
const TextColors={BLACK:0,WHITE:1};
class BackgroundController{
  static DEFAULT_COLOR="#212121";
  constructor(element){
    this.element=element;
    this.colorInput=document.createElement("input");
    this.colorInput.type="color";
    this.colorInput.value=this.getSavedColor();
    this.colorInput.style.visibility="hidden";
    this.element.parentElement.appendChild(this.colorInput);
    this.element.addEventListener("click",()=>this.colorInput.click());
    this.colorInput.addEventListener("input",()=>{let v=this.colorInput.value; this.setSavedColor(v); this.displayColor(v);});
    this.displaySavedColor();
  }
  getSavedColor(){return localStorage.savedColor||BackgroundController.DEFAULT_COLOR}
  setSavedColor(v){localStorage.savedColor=v}
  hasSavedColor(){return!!localStorage.savedColor}
  displayColor(color){
    document.body.style.backgroundColor=color;
    if(BackgroundController.getTextColor(color)===TextColors.BLACK)document.body.classList.add("black-text");
    else document.body.classList.remove("black-text");
  }
  displaySavedColor(){if(this.hasSavedColor())this.displayColor(this.getSavedColor())}
  static getTextColor(color){
    const r=parseInt(color.substr(1,2),16), g=parseInt(color.substr(3,2),16), b=parseInt(color.substr(5,2),16);
    return ((r*299+g*587+b*114)/1000)>=128?TextColors.BLACK:TextColors.WHITE;
  }
}

/* ================= DateDisplay ================= */
const DateStyles={DEFAULT:1,SWAP_MD:2};
class DateDisplay{
  constructor(el){this.el=el; this.dateStyle=this.getSavedStyle(); this.render(); this.startInterval();}
  startInterval(){this.el.addEventListener("click",()=>this.onClickedDate()); setInterval(()=>this.render(),60000);}
  render(){let d=new Date(); let p={month:d.getMonth()+1, day:d.getDate(), year:d.getFullYear()}; this.el.textContent=(this.dateStyle===DateStyles.SWAP_MD?[p.month,p.day,p.year].join('/'):[p.day,p.month,p.year].join('/'));}
  onClickedDate(){this.dateStyle=this.dateStyle===DateStyles.DEFAULT?DateStyles.SWAP_MD:DateStyles.DEFAULT; this.setSavedStyle(this.dateStyle); this.render();}
  setSavedStyle(v){localStorage.dateStyle=v}
  getSavedStyle(){return Number(localStorage.dateStyle)||DateStyles.DEFAULT}
}

/* ================= TimeDisplay ================= */
const TimeStyles={AM_PM:1,AM_PM_NO_SECONDS:2};
class TimeDisplay{
  constructor(el){this.el=el; this.timeStyle=this.getSavedStyle(); this.render(); this.startInterval();}
  startInterval(){this.el.addEventListener("click",()=>this.onClickedTime()); setInterval(()=>this.render(),1000);}
  render(){let d=new Date(); let t={hours:d.getHours(),hoursAmerican:((d.getHours()-1)%12+1),amPm:d.getHours()>=12?"PM":"AM",minutes:String(d.getMinutes()).padStart(2,"0"),seconds:String(d.getSeconds()).padStart(2,"0")};
    switch(this.timeStyle){
      case TimeStyles.AM_PM:this.el.textContent=`${t.hoursAmerican}:${t.minutes}:${t.seconds} ${t.amPm}`; break;
      case TimeStyles.AM_PM_NO_SECONDS:this.el.textContent=`${t.hoursAmerican}:${t.minutes} ${t.amPm}`; break;
    }
  }
  onClickedTime(){this.timeStyle=this.timeStyle===TimeStyles.AM_PM_NO_SECONDS?TimeStyles.AM_PM:TimeStyles.AM_PM_NO_SECONDS; this.setSavedStyle(this.timeStyle); this.render();}
  setSavedStyle(v){localStorage.timeStyle=v}
  getSavedStyle(){return Number(localStorage.timeStyle)||TimeStyles.AM_PM}
}

/* ================= BatteryDisplay ================= */
class BatteryDisplay{
  eventNames=["chargingchange","chargingtimechange","dischargingtimechange","levelchange"];
  constructor(el){this.el=el; this.render(); this.listenForUpdates();}
  async getBattery(){if(!navigator.getBattery)return null; let b=null; try{b=await navigator.getBattery()}catch{return null;} b.secsLeft=Math.min(b.chargingTime,b.dischargingTime); b.isFull=b.level===1; return b;}
  async render(){const b=await this.getBattery(); if(!b){this.el.textContent="Battery unavailable"; return;} this.el.textContent=b.isFull?"Battery full":[`Battery: ${Math.round(b.level*100)}%`,b.charging?"Charging":"Not charging",`Around ${Math.floor(b.secsLeft/3600)}:${String(Math.floor(b.secsLeft%3600/60)).padStart(2,"0")} until ${b.charging?"full":"empty"}`].join(" ~ "); }
  async listenForUpdates(){const b=await this.getBattery(); if(!b)return; for(let e of this.eventNames)b.addEventListener(e,()=>this.render()); }
}

/* ================= Init ================= */
document.querySelector(".version").textContent="v1.0.0 web";

const moveIcon=document.getElementById("move");
const fullscreenIcon=document.getElementById("fullscreen");
const batteryEl=document.querySelector(".battery");
const dateEl=document.querySelector(".date");
const timeEl=document.querySelector(".time");
const colorChange=document.getElementById("colorchange");

new DragController(moveIcon);
new FullscreenController(fullscreenIcon);
new BatteryDisplay(batteryEl);
new DateDisplay(dateEl);
new TimeDisplay(timeEl);
new BackgroundController(colorChange);

/* ================= Fullscreen ================= */
class FullscreenController{
  constructor(el){el.onclick=()=>{if(!document.fullscreenElement)document.documentElement.requestFullscreen(); else document.exitFullscreen();};}
}

/* ================= Links ================= */
document.getElementById("help").onclick=()=>window.open("https://github.com/AceOfSpades1061/skiovox-helper_mv3","_blank");
document.getElementById("webstore").onclick=()=>window.open("https://chromewebstore.google.com","_blank");
document.getElementById("addaccount").onclick=()=>window.open("https://accounts.google.com/v3/signin/identifier","_blank");
document.getElementById("reset").onclick=()=>{if(confirm("Reset Skiovox Helper settings?")){localStorage.clear(); location.reload();}};
document.getElementById("theme").onclick=document.getElementById("colorchange").onclick;
</script>
</body>
</html>
